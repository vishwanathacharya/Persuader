name: Secret Key Detector

on: [push, pull_request]

jobs:
  scan-secrets:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Install TruffleHog
        run: pip install truffleHog

      - name: Scan for Secrets
        id: secret_scan
        continue-on-error: true
        run: |
          truffleHog --regex --entropy=True . > secret_scan_results.txt || true
          if grep -q "Reason" secret_scan_results.txt; then
            echo "Secrets detected!"
            echo "SECRETS_FOUND=true" >> $GITHUB_ENV
          else
            echo "No secrets found."
            echo "SECRETS_FOUND=false" >> $GITHUB_ENV
          fi

      - name: Send Email Alert (if secrets found)
        if: env.SECRETS_FOUND == 'true'
        run: |
          echo "AWS Key or Secret Key detected in repository!" | mail -s "ALERT: Secret Key Found!" ${{ secrets.ADMIN_EMAIL }}
